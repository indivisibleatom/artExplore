<!doctype html>
<html lang="en">
    <head>
        <title>Argon Basic Yippee</title>
        <link rel="apple-touch-icon" href="assets/sample_icon_57x57.png" />
        <link rel="stylesheet" href="css/jslog.css" />
        <link rel="stylesheet" href="css/comment.css" />
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
        <meta name="arenabled" />
    </head>
    <body>
	  <script src="js/jslog.js"></script>
        <script src="http://argon.gatech.edu/argon_o.js"></script>
        <script>
            var dataset, stonesTarget, trackedObject;
            var redCube, redMaterial, redGeometry;
            var currentGrid = -1, prevGrid = -1;

            var artExploreController =
            {   
            onRender : function()
                       {
                       },
            
            getCurrentGrid: function()
                           {
                               if (trackedObject.threeObject3D.matrix.decompose()[0].x > -100 && trackedObject.threeObject3D.matrix.decompose()[0].x < 100)
                               {
                                   return 0;
                               }
                               else if (trackedObject.threeObject3D.matrix.decompose()[0].x < -100)
                               {
                                   return 1;
                               }
                               else if (trackedObject.threeObject3D.matrix.decompose()[0].x > 100 && trackedObject.threeObject3D.matrix.decompose()[0].x < 300)
                               {
                                   return 2;
                               }
                           },
             
            makeCommentRequest: function(grid)
                           {
                              xmlhttp = new XMLHttpRequest();
                              xmlhttp.onreadystatechange=function()
                              {
                                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                                {
                                  var result=JSON.parse(xmlhttp.responseText);
                                  document.getElementById("commentList").innerHTML = "";
                                  for (var i = 0; i < result.length; i++)
                                  {
                                    document.getElementById("commentList").innerHTML+= result[i].COMMENT;
                                    document.getElementById("commentList").innerHTML+= " " + result[i].LIKES;
                                    document.getElementById("commentList").innerHTML+= "<br/>"
                                  }
                                }
                              }
                              
                              xmlhttp.open("GET","/getComment?ID=1&gridX=1&gridY=1&gridZ=1", true);
                              xmlhttp.send();
                            },
                              
                       
            checkSameGrid : function()
                           {                              
                              if (stonesTarget._visible)
                              {
                                   var newCurrent = artExploreController.getCurrentGrid();
                                   if (newCurrent == currentGrid && currentGrid != prevGrid)
                                   {
                                      artExploreController.makeCommentRequest(newCurrent);
                                   }
                                   prevGrid = currentGrid;
                                   currentGrid = newCurrent;
                              }
                           },
            
            makeDataSetRequest : function()
                           {
                              if (navigator.geolocation)
                              {
                                navigator.geolocation.getCurrentPosition(function(position){
                                  xmlhttp = new XMLHttpRequest();
                                  
                                  xmlhttp.onreadystatechange=function()
                                  {
                                    if (xmlhttp.readyState==4 && xmlhttp.status==200)
                                    {                                  
                                      var muralInfo = JSON.parse(xmlhttp.responseText);
                                      ARGON.loadDataset(muralInfo.xml);
                                    }
                                  }
                                  
                                  xmlhttp.open("GET","/getMuralInfo?ID=1", true);
                                  //xmlhttp.open("GET","/getMuralInfo?lat="+position.coords.latitude+"&long="+position.coords.longitude, true);
                                  xmlhttp.send();                                  
                                });
                              }
                           },

            onArgonReady : function()
                           {
                               artExploreController.makeDataSetRequest();                               
                           },
             
            onDataSetLoaded : function(event)
                              {                  
                                  dataset      = event.dataset;
                                  stonesTarget = dataset.targets["vendingCube"];

                                  if (stonesTarget)
                                  {
                                      trackedObject        = new ARGON.TrackedObject();
                                      trackedObject.name   = "vendingMainTarget"; 

                                      trackedObject.autoHideAfterFrames = 1;
                                      trackedObject.setTarget( stonesTarget );

                                      ARGON.onRender = artExploreController.onRender;
                                      window.setInterval(artExploreController.checkSameGrid,2000);
                                  }
                              }
                        };
                            
          document.addEventListener("AR.DataSetLoadedEvent", artExploreController.onDataSetLoaded);
          document.addEventListener("AR.DataSetActivatedEvent", artExploreController.onDataSetActivated);
          document.addEventListener("AR.ArgonReadyEvent", artExploreController.onArgonReady);
			
        </script>
        
        <div id="commentList"></div>
    </body>
    
    
</html>            
